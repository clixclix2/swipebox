/*! Swipebox v1.4.4 | Constantin Saguin csag.co | MIT License | github.com/brutaldesign/swipebox */
/* Pinch-zoom added by Claudio Castelpietra - www.itala.net - 21/09/2015 */
!function(g,c,M,h){M.swipebox=function(o,e){var r,a,t={useCSS:!0,useSVG:!0,initialIndexOnArray:0,removeBarsOnMobile:!0,hideCloseButtonOnMobile:!1,hideBarsDelay:3e3,videoMaxWidth:1140,vimeoColor:"cccccc",beforeOpen:null,afterOpen:null,afterClose:null,afterMedia:null,nextSlide:null,prevSlide:null,loopAtEnd:!1,autoplayVideos:!1,queryStringData:{},toggleClassOnLoad:""},n=this,x=[],l=o.selector,i=navigator.userAgent.match(/(iPad)|(iPhone)|(iPod)|(Android)|(PlayBook)|(BB10)|(BlackBerry)|(Opera Mini)|(IEMobile)|(webOS)|(MeeGo)/i),s=null!==i||c.createTouch!==h||"ontouchstart"in g||"onmsgesturechange"in g||navigator.msMaxTouchPoints,d=!!c.createElementNS&&!!c.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect,v=g.innerWidth?g.innerWidth:M(g).width(),p=g.innerHeight?g.innerHeight:M(g).height(),T=0;n.settings={},M.swipebox.close=function(){r.closeSlide()},M.swipebox.extend=function(){return r},n.init=function(){n.settings=M.extend({},t,e),M.isArray(o)?(x=o,r.target=M(g),r.init(n.settings.initialIndexOnArray)):M(c).on("click",l,function(e){if("slide current"===e.target.parentNode.className)return!1;var t,i,s;M.isArray(o)||(r.destroy(),a=M(l),r.actions()),x=[],s||(i="data-rel",s=M(this).attr(i)),s||(i="rel",s=M(this).attr(i)),(a=s&&""!==s&&"nofollow"!==s?M(l).filter("["+i+'="'+s+'"]'):M(l)).each(function(){var e=null,t=null;M(this).attr("title")&&(e=M(this).attr("title")),M(this).attr("href")&&(t=M(this).attr("href")),x.push({href:t,title:e})}),t=a.index(M(this)),e.preventDefault(),e.stopPropagation(),r.target=M(e.target),r.init(t)})},r={init:function(e){n.settings.beforeOpen&&n.settings.beforeOpen(),this.target.trigger("swipebox-start"),M.swipebox.isOpen=!0,this.build(),this.openSlide(e),this.openMedia(e),this.preloadMedia(e+1),this.preloadMedia(e-1),n.settings.afterOpen&&n.settings.afterOpen(e)},build:function(){var e,t=this;M("body").append('<div id="swipebox-overlay">\t\t\t\t\t<div id="swipebox-container">\t\t\t\t\t\t<div id="swipebox-slider"></div>\t\t\t\t\t\t<div id="swipebox-top-bar">\t\t\t\t\t\t\t<div id="swipebox-title"></div>\t\t\t\t\t\t</div>\t\t\t\t\t\t<div id="swipebox-bottom-bar">\t\t\t\t\t\t\t<div id="swipebox-arrows">\t\t\t\t\t\t\t\t<a id="swipebox-prev"></a>\t\t\t\t\t\t\t\t<a id="swipebox-next"></a>\t\t\t\t\t\t\t</div>\t\t\t\t\t\t</div>\t\t\t\t\t\t<a id="swipebox-close"></a>\t\t\t\t\t</div>\t\t\t</div>'),d&&!0===n.settings.useSVG&&(e=(e=M("#swipebox-close").css("background-image")).replace("png","svg"),M("#swipebox-prev, #swipebox-next, #swipebox-close").css({"background-image":e})),i&&n.settings.removeBarsOnMobile&&M("#swipebox-bottom-bar, #swipebox-top-bar").remove(),M.each(x,function(){M("#swipebox-slider").append('<div class="slide"></div>')}),t.setDim(),t.actions(),s&&t.gesture(),t.keyboard(),t.animBars(),t.resize()},setDim:function(){var e,t,i;"onorientationchange"in g?g.addEventListener("orientationchange",function(){0===g.orientation?(e=v,t=p):90!==g.orientation&&-90!==g.orientation||(e=p,t=v)},!1):(e=g.innerWidth?g.innerWidth:M(g).width(),t=g.innerHeight?g.innerHeight:M(g).height()),i={width:e,height:t},M("#swipebox-overlay").css(i)},resize:function(){var e=this;M(g).resize(function(){e.setDim()}).resize()},supportTransition:function(){var e,t="transition WebkitTransition MozTransition OTransition msTransition KhtmlTransition".split(" ");for(e=0;e<t.length;e++)if(c.createElement("div").style[t[e]]!==h)return t[e];return!1},doCssTrans:function(){if(n.settings.useCSS&&this.supportTransition())return!0},gesture:function(){var n,l,d,p,g,c,i=this,h=!1,b=!1,m={},u={},f={inProgress:!1,lastZoom:100,overZoom:!1},s=M("#swipebox-top-bar, #swipebox-bottom-bar"),w=M("#swipebox-slider");s.addClass("visible-bars"),i.setTimeout(),M("body").bind("touchstart",function(e){return M(this).addClass("touching"),n=M("#swipebox-slider .slide").index(M("#swipebox-slider .slide.current")),u=e.originalEvent.targetTouches[0],m.pageX=e.originalEvent.targetTouches[0].pageX,m.pageY=e.originalEvent.targetTouches[0].pageY,1<e.originalEvent.targetTouches.length?(f.inProgress=!0,f.startZoom=f.lastZoom,f.startDistance=Math.sqrt(Math.pow(e.originalEvent.targetTouches[0].pageX-e.originalEvent.targetTouches[1].pageX,2)+Math.pow(e.originalEvent.targetTouches[0].pageY-e.originalEvent.targetTouches[1].pageY,2)),100==f.lastZoom&&(f.marginTop=0,f.marginLeft=0,f.diffHeight=0,f.diffWidth=0)):f.inProgress=!1,f.inProgress||f.overZoom||M("#swipebox-slider").css({"-webkit-transform":"translate3d("+T+"%, 0, 0)",transform:"translate3d("+T+"%, 0, 0)"}),M(".touching").bind("touchmove",function(e){if(e.preventDefault(),e.stopPropagation(),u=e.originalEvent.targetTouches[0],f.inProgress){var t=Math.sqrt(Math.pow(e.originalEvent.targetTouches[0].pageX-e.originalEvent.targetTouches[1].pageX,2)+Math.pow(e.originalEvent.targetTouches[0].pageY-e.originalEvent.targetTouches[1].pageY,2)),i=f.startZoom*(1+(t-f.startDistance)/f.startDistance);i=Math.max(100,i);var s=f.lastZoom,o=f.diffHeight,a=f.diffWidth;return f.lastZoom=i,M("#swipebox-slider .current img").css({"max-width":i+"%","max-height":i+"%"}),f.diffHeight=Math.max(0,M("#swipebox-slider .current img").height()-M("#swipebox-slider .current").height()),f.diffWidth=Math.max(0,M("#swipebox-slider .current img").width()-M("#swipebox-slider .current").width()),f.overZoom=!1,0<f.diffHeight?(f.marginTop+=-(f.diffHeight-o)/2,f.marginTop=Math.min(0,f.marginTop),f.marginTop=Math.max(-f.diffHeight,f.marginTop),f.overZoom=!0):f.marginTop=0,0<f.diffWidth?(f.marginLeft+=-(f.diffWidth-a)/2,f.marginLeft=Math.min(0,f.marginLeft),f.marginLeft=Math.max(-f.diffWidth,f.marginLeft),f.overZoom=!0):f.marginLeft=0,M("#swipebox-slider .current img").css({"margin-top":f.marginTop+"px","margin-left":f.marginLeft+"px"}),void(o==f.diffHeight&&a==f.diffWidth&&(f.lastZoom=s,f.diffHeight=o,f.diffWidth=a))}if(f.overZoom)return f.lastMarginTop=f.marginTop+u.pageY-m.pageY,f.lastMarginTop=Math.min(0,f.lastMarginTop),f.lastMarginTop=Math.max(-f.diffHeight,f.lastMarginTop),f.lastMarginLeft=f.marginLeft+u.pageX-m.pageX,f.lastMarginLeft=Math.min(0,f.lastMarginLeft),f.lastMarginLeft=Math.max(-f.diffWidth,f.lastMarginLeft),void M("#swipebox-slider .current img").css({"margin-top":f.lastMarginTop+"px","margin-left":f.lastMarginLeft+"px"});if(!b&&(g=d,d=u.pageY-m.pageY,50<=Math.abs(d)||h)){var r=.75-Math.abs(d)/w.height();w.css({top:d+"px"}),w.css({opacity:r}),h=!0}p=l,l=u.pageX-m.pageX,c=100*l/v,!b&&!h&&10<=Math.abs(l)&&(M("#swipebox-slider").css({"-webkit-transition":"",transition:""}),b=!0),b&&(0<l?0===n?M("#swipebox-overlay").addClass("leftSpringTouch"):(M("#swipebox-overlay").removeClass("leftSpringTouch").removeClass("rightSpringTouch"),M("#swipebox-slider").css({"-webkit-transform":"translate3d("+(T+c)+"%, 0, 0)",transform:"translate3d("+(T+c)+"%, 0, 0)"})):l<0&&(x.length===n+1?M("#swipebox-overlay").addClass("rightSpringTouch"):(M("#swipebox-overlay").removeClass("leftSpringTouch").removeClass("rightSpringTouch"),M("#swipebox-slider").css({"-webkit-transform":"translate3d("+(T+c)+"%, 0, 0)",transform:"translate3d("+(T+c)+"%, 0, 0)"}))))}),!1}).bind("touchend",function(e){if(e.preventDefault(),e.stopPropagation(),!f.inProgress&&f.overZoom&&(f.marginTop=f.lastMarginTop,f.marginLeft=f.lastMarginLeft),f.inProgress||f.overZoom)M(".touching").off("touchmove").removeClass("touching");else{if(M("#swipebox-slider").css({"-webkit-transition":"-webkit-transform 0.4s ease",transition:"transform 0.4s ease"}),d=u.pageY-m.pageY,l=u.pageX-m.pageX,c=100*l/v,h)if(h=!1,100<=Math.abs(d)&&Math.abs(d)>Math.abs(g)){var t=0<d?w.height():-w.height();w.animate({top:t+"px",opacity:0},300,function(){i.closeSlide()})}else w.animate({top:0,opacity:1},300);else b?(b=!1,10<=l&&p<=l?(100<f.lastZoom&&(M("#swipebox-slider .current img").css({"max-width":"100%","max-height":"100%","margin-top":"","margin-left":""}),f.lastZoom=100),i.getPrev()):l<=-10&&l<=p&&(100<f.lastZoom&&(M("#swipebox-slider .current img").css({"max-width":"100%","max-height":"100%","margin-top":"","margin-left":""}),f.lastZoom=100),i.getNext())):s.hasClass("visible-bars")?(i.clearTimeout(),i.hideBars()):(i.showBars(),i.setTimeout());M("#swipebox-slider").css({"-webkit-transform":"translate3d("+T+"%, 0, 0)",transform:"translate3d("+T+"%, 0, 0)"}),M("#swipebox-overlay").removeClass("leftSpringTouch").removeClass("rightSpringTouch"),M(".touching").off("touchmove").removeClass("touching")}})},setTimeout:function(){if(0<n.settings.hideBarsDelay){var e=this;e.clearTimeout(),e.timeout=g.setTimeout(function(){e.hideBars()},n.settings.hideBarsDelay)}},clearTimeout:function(){g.clearTimeout(this.timeout),this.timeout=null},showBars:function(){var e=M("#swipebox-top-bar, #swipebox-bottom-bar");this.doCssTrans()?e.addClass("visible-bars"):(M("#swipebox-top-bar").animate({top:0},500),M("#swipebox-bottom-bar").animate({bottom:0},500),setTimeout(function(){e.addClass("visible-bars")},1e3))},hideBars:function(){var e=M("#swipebox-top-bar, #swipebox-bottom-bar");this.doCssTrans()?e.removeClass("visible-bars"):(M("#swipebox-top-bar").animate({top:"-50px"},500),M("#swipebox-bottom-bar").animate({bottom:"-50px"},500),setTimeout(function(){e.removeClass("visible-bars")},1e3))},animBars:function(){var e=this,t=M("#swipebox-top-bar, #swipebox-bottom-bar");t.addClass("visible-bars"),e.setTimeout(),M("#swipebox-slider").click(function(){t.hasClass("visible-bars")||(e.showBars(),e.setTimeout())}),M("#swipebox-bottom-bar").hover(function(){e.showBars(),t.addClass("visible-bars"),e.clearTimeout()},function(){0<n.settings.hideBarsDelay&&(t.removeClass("visible-bars"),e.setTimeout())})},keyboard:function(){var t=this;M(g).bind("keyup",function(e){e.preventDefault(),e.stopPropagation(),37===e.keyCode?t.getPrev():39===e.keyCode?t.getNext():27===e.keyCode&&t.closeSlide()})},actions:function(){var t=this,e="touchend click";x.length<2?(M("#swipebox-bottom-bar").hide(),h===x[1]&&M("#swipebox-top-bar").hide()):(M("#swipebox-prev").bind(e,function(e){e.preventDefault(),e.stopPropagation(),t.getPrev(),t.setTimeout()}),M("#swipebox-next").bind(e,function(e){e.preventDefault(),e.stopPropagation(),t.getNext(),t.setTimeout()})),M("#swipebox-close").bind(e,function(){t.closeSlide()})},setSlide:function(e,t){t=t||!1;var i=M("#swipebox-slider");T=100*-e,this.doCssTrans()?i.css({"-webkit-transform":"translate3d("+100*-e+"%, 0, 0)",transform:"translate3d("+100*-e+"%, 0, 0)"}):i.animate({left:100*-e+"%"}),M("#swipebox-slider .slide").removeClass("current"),M("#swipebox-slider .slide").eq(e).addClass("current"),this.setTitle(e),t&&i.fadeIn(),M("#swipebox-prev, #swipebox-next").removeClass("disabled"),0===e?M("#swipebox-prev").addClass("disabled"):e===x.length-1&&!0!==n.settings.loopAtEnd&&M("#swipebox-next").addClass("disabled")},openSlide:function(e){M("html").addClass("swipebox-html"),s?(M("html").addClass("swipebox-touch"),n.settings.hideCloseButtonOnMobile&&M("html").addClass("swipebox-no-close-button")):M("html").addClass("swipebox-no-touch"),M(g).trigger("resize"),this.setSlide(e,!0)},preloadMedia:function(e){var t=this,i=null;x[e]!==h&&(i=x[e].href),t.isVideo(i)?t.openMedia(e):setTimeout(function(){t.openMedia(e)},1e3)},openMedia:function(e){var t,i;if(x[e]!==h&&(t=x[e].href),e<0||e>=x.length)return!1;i=M("#swipebox-slider .slide").eq(e),this.isVideo(t)?(i.html(this.getVideo(t)),n.settings.afterMedia&&n.settings.afterMedia(e)):(i.addClass("slide-loading"),this.loadMedia(t,function(){i.removeClass("slide-loading"),i.html(this),n.settings.afterMedia&&n.settings.afterMedia(e)}))},setTitle:function(e){var t=null;M("#swipebox-title").empty(),x[e]!==h&&(t=x[e].title),t?(M("#swipebox-top-bar").show(),M("#swipebox-title").append(t)):M("#swipebox-top-bar").hide()},isVideo:function(e){if(e){if(e.match(/(youtube\.com|youtube-nocookie\.com)\/watch\?v=([a-zA-Z0-9\-_]+)/)||e.match(/vimeo\.com\/([0-9]*)/)||e.match(/youtu\.be\/([a-zA-Z0-9\-_]+)/))return!0;if(0<=e.toLowerCase().indexOf("swipeboxvideo=1"))return!0}},parseUri:function(e,t){var i=c.createElement("a"),s={};return i.href=decodeURIComponent(e),i.search&&(s=JSON.parse('{"'+i.search.toLowerCase().replace("?","").replace(/&/g,'","').replace(/=/g,'":"')+'"}')),M.isPlainObject(t)&&(s=M.extend(s,t,n.settings.queryStringData)),M.map(s,function(e,t){if(e&&""<e)return encodeURIComponent(t)+"="+encodeURIComponent(e)}).join("&")},getVideo:function(e){var t="",i=e.match(/((?:www\.)?youtube\.com|(?:www\.)?youtube-nocookie\.com)\/watch\?v=([a-zA-Z0-9\-_]+)/),s=e.match(/(?:www\.)?youtu\.be\/([a-zA-Z0-9\-_]+)/),o=e.match(/(?:www\.)?vimeo\.com\/([0-9]*)/),a="";return i||s?(s&&(i=s),a=r.parseUri(e,{autoplay:n.settings.autoplayVideos?"1":"0",v:""}),t='<iframe width="560" height="315" src="//'+i[1]+"/embed/"+i[2]+"?"+a+'" frameborder="0" allowfullscreen></iframe>'):o?(a=r.parseUri(e,{autoplay:n.settings.autoplayVideos?"1":"0",byline:"0",portrait:"0",color:n.settings.vimeoColor}),t='<iframe width="560" height="315"  src="//player.vimeo.com/video/'+o[1]+"?"+a+'" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>'):t='<iframe width="560" height="315" src="'+e+'" frameborder="0" allowfullscreen></iframe>','<div class="swipebox-video-container" style="max-width:'+n.settings.videoMaxWidth+'px"><div class="swipebox-video">'+t+"</div></div>"},loadMedia:function(e,t){if(0===e.trim().indexOf("#"))t.call(M("<div>",{class:"swipebox-inline-container"}).append(M(e).clone().toggleClass(n.settings.toggleClassOnLoad)));else if(!this.isVideo(e)){var i=M("<img>").on("load",function(){t.call(i)});i.attr("src",e)}},getNext:function(){var e,t=this,i=M("#swipebox-slider .slide").index(M("#swipebox-slider .slide.current"));i+1<x.length?(e=M("#swipebox-slider .slide").eq(i).contents().find("iframe").attr("src"),M("#swipebox-slider .slide").eq(i).contents().find("iframe").attr("src",e),i++,t.setSlide(i),t.preloadMedia(i+1),n.settings.nextSlide&&n.settings.nextSlide(i)):!0===n.settings.loopAtEnd?(e=M("#swipebox-slider .slide").eq(i).contents().find("iframe").attr("src"),M("#swipebox-slider .slide").eq(i).contents().find("iframe").attr("src",e),i=0,t.preloadMedia(i),t.setSlide(i),t.preloadMedia(i+1),n.settings.nextSlide&&n.settings.nextSlide(i)):(M("#swipebox-overlay").addClass("rightSpring"),setTimeout(function(){M("#swipebox-overlay").removeClass("rightSpring")},500))},getPrev:function(){var e,t=M("#swipebox-slider .slide").index(M("#swipebox-slider .slide.current"));0<t?(e=M("#swipebox-slider .slide").eq(t).contents().find("iframe").attr("src"),M("#swipebox-slider .slide").eq(t).contents().find("iframe").attr("src",e),t--,this.setSlide(t),this.preloadMedia(t-1),n.settings.prevSlide&&n.settings.prevSlide(t)):(M("#swipebox-overlay").addClass("leftSpring"),setTimeout(function(){M("#swipebox-overlay").removeClass("leftSpring")},500))},nextSlide:function(e){},prevSlide:function(e){},closeSlide:function(){M("html").removeClass("swipebox-html"),M("html").removeClass("swipebox-touch"),M(g).trigger("resize"),this.destroy()},destroy:function(){M(g).unbind("keyup"),M("body").unbind("touchstart"),M("body").unbind("touchmove"),M("body").unbind("touchend"),M("#swipebox-slider").unbind(),M("#swipebox-overlay").remove(),M.isArray(o)||o.removeData("_swipebox"),this.target&&this.target.trigger("swipebox-destroy"),M.swipebox.isOpen=!1,n.settings.afterClose&&n.settings.afterClose()}},n.init()},M.fn.swipebox=function(e){if(!M.data(this,"_swipebox")){var t=new M.swipebox(this,e);this.data("_swipebox",t)}return this.data("_swipebox")}}(window,document,jQuery);
